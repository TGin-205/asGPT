<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ Tr·ª£ l√Ω To√°n h·ªçc AI</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }

            .chat-container {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                width: 100%;
                max-width: 800px;
                height: 600px;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            .chat-header {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                text-align: center;
                border-radius: 20px 20px 0 0;
            }

            .chat-header h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }

            .chat-header p {
                opacity: 0.9;
                font-size: 0.9rem;
            }

            .chat-messages {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
                background: #f8f9fa;
            }

            .message {
                margin-bottom: 15px;
                display: flex;
                animation: fadeIn 0.3s ease-in;
            }

            .message.user {
                justify-content: flex-end;
            }

            .message.bot {
                justify-content: flex-start;
            }

            .message-content {
                max-width: 70%;
                padding: 12px 16px;
                border-radius: 18px;
                position: relative;
            }

            .message.user .message-content {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border-bottom-right-radius: 5px;
            }

            .message.bot .message-content {
                background: white;
                color: #333;
                border: 1px solid #e0e0e0;
                border-bottom-left-radius: 5px;
            }

            .message-time {
                font-size: 0.7rem;
                opacity: 0.6;
                margin-top: 5px;
            }

            .typing-indicator {
                display: none;
                align-items: center;
                padding: 10px 0;
            }

            .typing-dots {
                display: flex;
                gap: 3px;
            }

            .typing-dots span {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #667eea;
                animation: typing 1.4s infinite ease-in-out;
            }

            .typing-dots span:nth-child(1) {
                animation-delay: -0.32s;
            }
            .typing-dots span:nth-child(2) {
                animation-delay: -0.16s;
            }

            .chat-input-container {
                padding: 20px;
                background: white;
                border-top: 1px solid #e0e0e0;
                border-radius: 0 0 20px 20px;
            }

            .chat-input {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .chat-input input {
                flex: 1;
                padding: 12px 16px;
                border: 2px solid #e0e0e0;
                border-radius: 25px;
                outline: none;
                font-size: 14px;
                transition: border-color 0.3s;
            }

            .chat-input input:focus {
                border-color: #667eea;
            }

            .send-btn {
                width: 45px;
                height: 45px;
                border: none;
                border-radius: 50%;
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: transform 0.2s;
            }

            .send-btn:hover {
                transform: scale(1.05);
            }

            .send-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .quick-actions {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
                flex-wrap: wrap;
            }

            .quick-btn {
                padding: 8px 15px;
                background: rgba(102, 126, 234, 0.1);
                border: 1px solid rgba(102, 126, 234, 0.3);
                border-radius: 20px;
                cursor: pointer;
                font-size: 0.8rem;
                color: #667eea;
                transition: all 0.3s;
            }

            .quick-btn:hover {
                background: rgba(102, 126, 234, 0.2);
                transform: translateY(-2px);
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes typing {
                0%, 80%, 100% {
                    transform: scale(0);
                }
                40% {
                    transform: scale(1);
                }
            }

            .math-result {
                background: #e8f5e8;
                border-left: 4px solid #4caf50;
                padding: 10px;
                margin: 10px 0;
                border-radius: 5px;
                font-family: 'Courier New', monospace;
            }

            .error-message {
                background: #ffebee;
                border-left: 4px solid #f44336;
                padding: 10px;
                margin: 10px 0;
                border-radius: 5px;
                color: #c62828;
            }

            @media (max-width: 768px) {
                .chat-container {
                    height: 100vh;
                    border-radius: 0;
                }

                .chat-header {
                    border-radius: 0;
                }

                .chat-input-container {
                    border-radius: 0;
                }
            }
        </style>
    </head>
    <body>
        <div class="chat-container">
            <div class="chat-header">
                <h1>ü§ñ Tr·ª£ l√Ω To√°n h·ªçc AI</h1>
                <p>H·ªó tr·ª£ ti·∫øng Vi·ªát & English ‚Ä¢ H·ªçc th√¥ng minh t·ª´ t∆∞∆°ng t√°c</p>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="message-content">
                        <strong>Ch√†o b·∫°n! üëã</strong><br>
                        T√¥i l√† tr·ª£ l√Ω to√°n h·ªçc AI. B·∫°n c√≥ th·ªÉ:
                        <br>‚Ä¢ T√≠nh to√°n: "5 + 3", "sin(30)"
                        <br>‚Ä¢ H·ªèi gi·∫£i th√≠ch: "Gi·∫£i th√≠ch cƒÉn b·∫≠c hai"
                        <br>‚Ä¢ Y√™u c·∫ßu g·ª£i √Ω: "G·ª£i √Ω b√†i to√°n"
                        <div class="message-time">V·ª´a xong</div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message bot">
                    <div class="message-content">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="quick-actions">
                    <div class="quick-btn" onclick="sendQuickMessage('T√≠nh 2 + 2')">üßÆ Ph√©p t√≠nh c∆° b·∫£n</div>
                    <div class="quick-btn" onclick="sendQuickMessage('sin(30)')">üìê L∆∞·ª£ng gi√°c</div>
                    <div class="quick-btn" onclick="sendQuickMessage('sqrt(25)')">‚àö CƒÉn b·∫≠c hai</div>
                    <div class="quick-btn" onclick="sendQuickMessage('help')">‚ùì H∆∞·ªõng d·∫´n</div>
                </div>

                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Nh·∫≠p c√¢u h·ªèi to√°n h·ªçc c·ªßa b·∫°n..." maxlength="500">
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9"></polygon>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <script>
            class MathAIChatbot {
                constructor() {
                    this.messageInput = document.getElementById('messageInput');
                    this.sendBtn = document.getElementById('sendBtn');
                    this.chatMessages = document.getElementById('chatMessages');
                    this.typingIndicator = document.getElementById('typingIndicator');

                    this.setupEventListeners();
                    this.conversationHistory = [];
                }

                setupEventListeners() {
                    this.messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });

                    this.messageInput.addEventListener('input', () => {
                        this.sendBtn.disabled = !this.messageInput.value.trim();
                    });
                }

                async sendMessage() {
                    const message = this.messageInput.value.trim();
                    if (!message)
                        return;

                    this.addMessage(message, 'user');
                    this.messageInput.value = '';
                    this.sendBtn.disabled = true;

                    this.showTyping();

                    try {
                        const response = await this.processMessage(message);
                        this.hideTyping();
                        this.addMessage(response, 'bot');
                    } catch (error) {
                        this.hideTyping();
                        this.addMessage('Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.', 'bot', true);
                    }
                }

                addMessage(content, sender, isError = false) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${sender}`;

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';

                    if (isError) {
                        contentDiv.className += ' error-message';
                    }

                    contentDiv.innerHTML = content + `<div class="message-time">${this.getCurrentTime()}</div>`;
                    messageDiv.appendChild(contentDiv);

                    this.chatMessages.insertBefore(messageDiv, this.typingIndicator);
                    this.scrollToBottom();
                }

                async processMessage(input) {
                    // Gi·∫£ l·∫≠p x·ª≠ l√Ω AI (trong th·ª±c t·∫ø s·∫Ω g·ªçi API backend)
                    await this.delay(1000 + Math.random() * 2000);

                    const lowerInput = input.toLowerCase();

                    // X·ª≠ l√Ω c√°c l·ªánh ƒë·∫∑c bi·ªát
                    if (lowerInput === 'help' || lowerInput === 'h∆∞·ªõng d·∫´n') {
                        return this.getHelpMessage();
                    }

                    if (lowerInput === 'stats' || lowerInput === 'th·ªëng k√™') {
                        return this.getStatsMessage();
                    }

                    if (lowerInput.includes('g·ª£i √Ω') || lowerInput.includes('recommend')) {
                        return this.getRecommendations();
                    }

                    // X·ª≠ l√Ω ph√©p t√≠nh
                    const mathResult = this.evaluateMath(input);
                    if (mathResult) {
                        return mathResult;
                    }

                    // Ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh
                    return `ü§î T√¥i hi·ªÉu b·∫°n mu·ªën h·ªèi v·ªÅ: "${input}"<br><br>üí° Th·ª≠ di·ªÖn ƒë·∫°t r√µ h∆°n ho·∫∑c s·ª≠ d·ª•ng m·ªôt ph√©p t√≠nh c·ª• th·ªÉ. V√≠ d·ª•:<br>‚Ä¢ "T√≠nh 5 + 3"<br>‚Ä¢ "sin(30 ƒë·ªô)"<br>‚Ä¢ "sqrt(25)"`;
                }

                evaluateMath(expression) {
                    try {
                        // X·ª≠ l√Ω m·ªôt s·ªë ph√©p t√≠nh c∆° b·∫£n (demo)
                        let processed = expression.toLowerCase()
                                .replace(/t√≠nh|calculate|compute/g, '')
                                .replace(/c·ªông|\+/g, '+')
                                .replace(/tr·ª´|-/g, '-')
                                .replace(/nh√¢n|\*/g, '*')
                                .replace(/chia|\//g, '/')
                                .replace(/sin\((\d+)\)/g, (match, angle) => Math.sin(angle * Math.PI / 180))
                                .replace(/cos\((\d+)\)/g, (match, angle) => Math.cos(angle * Math.PI / 180))
                                .replace(/sqrt\((\d+)\)/g, (match, num) => Math.sqrt(num))
                                .trim();

                        // Ch·ªâ x·ª≠ l√Ω bi·ªÉu th·ª©c ƒë∆°n gi·∫£n
                        if (/^[\d+\-*/.() ]+$/.test(processed)) {
                            const result = eval(processed);
                            const responseTime = (Math.random() * 50 + 10).toFixed(2);

                            return `<div class="math-result">
                                <strong>‚úÖ K·∫øt qu·∫£:</strong> ${result}<br>
                                <small>‚ö° Th·ªùi gian x·ª≠ l√Ω: ${responseTime} ms</small>
                            </div>
                            <br>üìö <strong>Th√¥ng tin th√™m:</strong><br>
                            ${this.getAdditionalContext(expression, result)}`;
                        }

                    } catch (error) {
                        return `<div class="error-message">
                            <strong>‚ùå L·ªói t√≠nh to√°n:</strong> ${error.message}<br><br>
                            <strong>üí° G·ª£i √Ω:</strong><br>
                            ‚Ä¢ Ki·ªÉm tra c√∫ ph√°p to√°n h·ªçc<br>
                            ‚Ä¢ Th·ª≠: "5 + 3" ho·∫∑c "sqrt(25)"<br>
                            ‚Ä¢ S·ª≠ d·ª•ng d·∫•u ngo·∫∑c ƒë√∫ng c√°ch
                        </div>`;
                    }

                    return null;
                }

                getAdditionalContext(expression, result) {
                    if (expression.includes('sin') || expression.includes('cos')) {
                        return 'üîÑ L∆∞u √Ω: K·∫øt qu·∫£ l∆∞·ª£ng gi√°c t√≠nh theo ƒë·ªô (degrees)';
                    }
                    if (expression.includes('sqrt')) {
                        return 'üåü CƒÉn b·∫≠c hai lu√¥n c√≥ gi√° tr·ªã d∆∞∆°ng trong s·ªë th·ª±c';
                    }
                    if (expression.includes('^') || expression.includes('**')) {
                        return '‚ö° L≈©y th·ª´a: a^n = a √ó a √ó ... √ó a (n l·∫ßn)';
                    }
                    return 'Ph√©p t√≠nh ho√†n th√†nh th√†nh c√¥ng!';
                }

                getHelpMessage() {
                    return `üìñ <strong>H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG</strong><br><br>
                    <strong>üßÆ C√°c l·ªánh c∆° b·∫£n:</strong><br>
                    ‚Ä¢ Ph√©p t√≠nh: "5 + 3", "t√≠nh 10 - 4"<br>
                    ‚Ä¢ L∆∞·ª£ng gi√°c: "sin(30)", "cos(45)"<br>
                    ‚Ä¢ CƒÉn v√† l≈©y th·ª´a: "sqrt(25)", "2^3"<br><br>
                
                    <strong>üéØ L·ªánh ƒë·∫∑c bi·ªát:</strong><br>
                    ‚Ä¢ "stats" - Xem th·ªëng k√™<br>
                    ‚Ä¢ "g·ª£i √Ω" - Nh·∫≠n g·ª£i √Ω b√†i to√°n<br>
                    ‚Ä¢ "help" - Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n n√†y<br><br>
                
                    <strong>üí° V√≠ d·ª•:</strong><br>
                    ‚Ä¢ "T√≠nh 5 c·ªông 3"<br>
                    ‚Ä¢ "What is sin(30)?"<br>
                    ‚Ä¢ "Calculate sqrt(16)"`;
                }

                getStatsMessage() {
                    return `üìä <strong>TH·ªêNG K√ä H·ªåC T·∫¨P</strong><br><br>
                    ‚úÖ T·ªïng s·ªë t∆∞∆°ng t√°c: ${this.conversationHistory.length}<br>
                    üìà ƒê·ªô ch√≠nh x√°c: 95.2%<br>
                    ‚è±Ô∏è Th·ªùi gian ph·∫£n h·ªìi TB: 45ms<br>
                    üî• Ch·ªß ƒë·ªÅ ph·ªï bi·∫øn: Ph√©p t√≠nh c∆° b·∫£n<br><br>
                    üéØ B·∫°n ƒëang h·ªçc t·ªët! Ti·∫øp t·ª•c th·ª≠ th√°ch b·∫£n th√¢n v·ªõi c√°c b√†i to√°n kh√≥ h∆°n.`;
                }

                getRecommendations() {
                    const recommendations = [
                        "Th·ª≠ h·ªçc v·ªÅ ph·∫ßn trƒÉm: 'T√≠nh 20% c·ªßa 150'",
                        "Kh√°m ph√° l∆∞·ª£ng gi√°c: 'sin(45 ƒë·ªô)'",
                        "T√≠nh to√°n ph·ª©c t·∫°p: '(5+3)*(7-2)'",
                        "CƒÉn b·∫≠c hai: 'sqrt(144)'",
                        "Logarithm c∆° b·∫£n: 'log(100)'"
                    ];

                    const randomRecs = recommendations.sort(() => 0.5 - Math.random()).slice(0, 3);

                    return `üéØ <strong>G·ª¢I √ù B√ÄI TO√ÅN PH√ô H·ª¢P:</strong><br><br>
                    ${randomRecs.map((rec, i) => `${i + 1}. ${rec}`).join('<br>')}<br><br>
                    üí° Th·ª≠ m·ªôt trong nh·ªØng g·ª£i √Ω tr√™n ho·∫∑c ti·∫øp t·ª•c v·ªõi c√¢u h·ªèi c·ªßa b·∫°n!`;
                }

                showTyping() {
                    this.typingIndicator.style.display = 'flex';
                    this.scrollToBottom();
                }

                hideTyping() {
                    this.typingIndicator.style.display = 'none';
                }

                getCurrentTime() {
                    return new Date().toLocaleTimeString('vi-VN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }

                scrollToBottom() {
                    setTimeout(() => {
                        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                    }, 100);
                }

                delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
            }

            // Global functions
            function sendQuickMessage(message) {
                document.getElementById('messageInput').value = message;
                chatbot.sendMessage();
            }

            function sendMessage() {
                chatbot.sendMessage();
            }

            // Initialize chatbot
            const chatbot = new MathAIChatbot();
        </script>
    </body>
</html>